# 数据标注指南

## 为什么需要标注？

深度学习模型需要标注好的数据来学习。标注就是告诉模型"图片中哪里有什么"。

## 标注工具推荐

### 1. LabelImg（推荐，最简单）

**安装**：
```bash
pip install labelImg
```

**启动**：
```bash
labelImg
```

**使用步骤**：
1. 点击"Open Dir"选择图片目录
2. 点击"Change Save Dir"选择标注保存目录
3. **重要**：在右侧选择"YOLO"格式（不是PascalVOC）
4. 打开第一张图片
5. 使用快捷键 `W` 创建边界框
6. 框选菜品区域
7. 选择类别（对应config.yaml中的dish_classes）
8. 保存（`Ctrl+S`）
9. 下一张（`D`键）或上一张（`A`键）

**快捷键**：
- `W`: 创建边界框
- `D`: 下一张
- `A`: 上一张
- `Del`: 删除选中的框
- `Ctrl+S`: 保存

### 2. CVAT（功能强大，适合团队）

在线工具：https://cvat.org/

### 3. Roboflow（在线平台）

网址：https://roboflow.com/

## 标注格式（YOLO格式）

每个标注文件（.txt）对应一张图片，文件名必须一致。

**格式**：
```
class_id x_center y_center width height
```

**参数说明**：
- `class_id`: 类别ID（从0开始）
  - 0 = 红烧肉
  - 1 = 宫保鸡丁
  - 2 = 麻婆豆腐
  - ...（对应config.yaml中的dish_classes顺序）
- `x_center, y_center`: 边界框中心点坐标（归一化到0-1）
- `width, height`: 边界框宽度和高度（归一化到0-1）

**示例**（image001.txt）：
```
0 0.5 0.5 0.3 0.4
1 0.2 0.3 0.15 0.2
```

这表示：
- 第一个菜品：类别0（红烧肉），中心在(0.5, 0.5)，宽高为(0.3, 0.4)
- 第二个菜品：类别1（宫保鸡丁），中心在(0.2, 0.3)，宽高为(0.15, 0.2)

## 标注技巧

### 1. 边界框要准确
- 尽量紧贴菜品边缘
- 不要包含太多背景
- 不要遗漏菜品部分

### 2. 一张图多个菜品
- 如果一张图中有多个菜品，每个菜品都要单独标注
- 每个菜品一行

### 3. 类别要正确
- 确保类别ID对应正确
- 参考config.yaml中的dish_classes列表

### 4. 标注质量
- 标注要一致（同一菜品在不同图片中标注方式要一致）
- 边界框要准确
- 类别要正确

## 标注工作量估算

**每个类别建议标注数量**：
- 最少：10-20张（仅用于测试）
- 推荐：50-100张（实际使用）
- 理想：100+张（最佳效果）

**10个类别的工作量**：
- 最少：100-200张图片
- 推荐：500-1000张图片
- 理想：1000+张图片

**标注时间**（每张图片）：
- 简单图片（1个菜品）：30秒-1分钟
- 复杂图片（多个菜品）：1-3分钟

**总时间估算**（500张图片）：
- 简单：约4-8小时
- 复杂：约8-25小时

## 快速开始标注

### 步骤1：准备图片

将所有图片放在一个目录，例如：
```
my_images/
├── photo001.jpg
├── photo002.jpg
└── ...
```

### 步骤2：启动LabelImg

```bash
labelImg
```

### 步骤3：设置

1. 点击"Open Dir"，选择 `my_images` 目录
2. 点击"Change Save Dir"，选择保存目录（建议：`my_images/labels`）
3. **重要**：在右侧选择"YOLO"格式

### 步骤4：开始标注

1. 打开第一张图片
2. 按 `W` 键创建边界框
3. 框选菜品
4. 选择类别
5. 按 `Ctrl+S` 保存
6. 按 `D` 键下一张
7. 重复步骤2-6

### 步骤5：检查标注

使用数据准备脚本检查：
```bash
python prepare_data.py --action check
```

## 常见问题

### Q: 标注文件应该放在哪里？
A: 按照YOLO格式，图片和标注文件应该分开：
- 图片：`data/train/images/`
- 标注：`data/train/labels/`

### Q: 文件名必须一致吗？
A: 是的！`image001.jpg` 对应 `image001.txt`

### Q: 可以一张图标注多个菜品吗？
A: 可以！每个菜品一行，例如：
```
0 0.5 0.5 0.3 0.4
1 0.2 0.3 0.15 0.2
```

### Q: 类别ID从哪里看？
A: 查看 `config.yaml` 中的 `dish_classes` 列表，顺序就是类别ID（从0开始）

### Q: 标注错了怎么办？
A: 在LabelImg中打开对应的图片，删除错误的框，重新标注

### Q: 可以批量修改类别吗？
A: 可以手动编辑.txt文件，但要确保格式正确

## 标注质量检查

标注完成后，运行检查：
```bash
python prepare_data.py --action check
```

检查项：
- ✅ 图片和标注文件是否匹配
- ✅ 标注格式是否正确
- ✅ 类别ID是否在有效范围内
- ✅ 坐标值是否在0-1之间

## 下一步

标注完成后：
1. 运行检查：`python prepare_data.py --action check`
2. 开始训练：`python train.py`
3. 评估模型：`python evaluate.py`

